<!DOCTYPE html>
<html lang="es">
<head>
ย ย <meta charset="UTF-8">
ย ย <meta name="viewport" content="width=device-width, initial-scale=1.0">
ย ย <title>Librerรญa Matita - Catรกlogo Completo</title>
ย ยย
ย ย <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,700;1,400&display=swap" rel="stylesheet">
ย ย <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
ย ยย
ย ย <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

ย ย <style>
ย ย ย ย :root {ย
ย ย ย ย ย ย --verde-oscuro: #0a3d31;ย
ย ย ย ย ย ย --verde-medio: #1a4d3e;ย
ย ย ย ย ย ย --dorado: #c5a35d;ย
ย ย ย ย ย ย --crema: #f9f7f2;ย
ย ย ย ย ย ย --blanco: #ffffff;ย
ย ย ย ย ย ย --rojo: #e74c3c;
ย ย ย ย ย ย --verde-whatsapp: #25d366;ย
ย ย ย ย ย ย --naranja: #e67e22;
ย ย ย ย ย ย --azul-pago: #3498db;
ย ย ย ย ย ย --shadow: 0 10px 30px rgba(0,0,0,0.08);
ย ย ย ย }
ย ย ย ยย
ย ย ย ย * { box-sizing: border-box; transition: all 0.3s ease; }
ย ย ย ยย
ย ย ย ย body {ย
ย ย ย ย ย ย margin: 0;ย
ย ย ย ย ย ย font-family: 'Montserrat', sans-serif;ย
ย ย ย ย ย ย background-color: var(--crema);ย
ย ย ย ย ย ย color: #333;ย
ย ย ย ย ย ย overflow-x: hidden;ย
ย ย ย ย ย ย padding-bottom: 120px;ย
ย ย ย ย }

ย ย ย ย /* BANNER PROMOCIONAL */
ย ย ย ย .promo-pack {
ย ย ย ย ย ย background: var(--naranja);ย
ย ย ย ย ย ย color: white;ย
ย ย ย ย ย ย text-align: center;
ย ย ย ย ย ย padding: 10px;ย
ย ย ย ย ย ย font-size: 0.8rem;ย
ย ย ย ย ย ย font-weight: 700;ย
ย ย ย ย ย ย text-transform: uppercase;
ย ย ย ย ย ย letter-spacing: 1px;
ย ย ย ย ย ย position: relative;
ย ย ย ย ย ย z-index: 1001;
ย ย ย ย }

ย ย ย ย /* HEADER & NAV */
ย ย ย ย header {ย
ย ย ย ย ย ย background: linear-gradient(135deg, var(--verde-oscuro) 0%, var(--verde-medio) 100%);ย
ย ย ย ย ย ย color: var(--blanco);ย
ย ย ย ย ย ย padding: 60px 20px;ย
ย ย ย ย ย ย text-align: center;
ย ย ย ย ย ย border-bottom: 5px solid var(--dorado);
ย ย ย ย }
ย ย ย ย header h1 { font-family: 'Playfair Display', serif; font-size: clamp(2.5rem, 8vw, 4rem); margin: 0; }

ย ย ย ย nav {ย
ย ย ย ย ย ย background: white;ย
ย ย ย ย ย ย padding: 15px;ย
ย ย ย ย ย ย text-align: center;ย
ย ย ย ย ย ย position: sticky;ย
ย ย ย ย ย ย top: 0;ย
ย ย ย ย ย ย z-index: 1000;ย
ย ย ย ย ย ย box-shadow: 0 2px 15px rgba(0,0,0,0.1);ย
ย ย ย ย ย ย display: flex;ย
ย ย ย ย ย ย justify-content: center;ย
ย ย ย ย ย ย gap: 25px;ย
ย ย ย ย ย ย flex-wrap: wrap;
ย ย ย ย }
ย ย ย ย nav a {ย
ย ย ย ย ย ย text-decoration: none;ย
ย ย ย ย ย ย color: var(--verde-oscuro);ย
ย ย ย ย ย ย font-weight: 700;ย
ย ย ย ย ย ย font-size: 0.85rem;ย
ย ย ย ย ย ย text-transform: uppercase;ย
ย ย ย ย ย ย letter-spacing: 1px;
ย ย ย ย }
ย ย ย ย nav a:hover { color: var(--dorado); }

ย ย ย ย .container { max-width: 1200px; margin: 0 auto; padding: 40px 20px; }

ย ย ย ย /* CATEGORรAS */
ย ย ย ย .category-container {
ย ย ย ย ย ย display: flex;ย
ย ย ย ย ย ย justify-content: center;ย
ย ย ย ย ย ย gap: 15px;ย
ย ย ย ย ย ย overflow-x: auto;
ย ย ย ย ย ย padding: 10px 5px 30px;ย
ย ย ย ย ย ย scrollbar-width: none;
ย ย ย ย }
ย ย ย ย .category-container::-webkit-scrollbar { display: none; }
ย ย ย ยย
ย ย ย ย .cat-card {ย
ย ย ย ย ย ย min-width: 110px;ย
ย ย ย ย ย ย padding: 20px 15px;ย
ย ย ย ย ย ย background: white;ย
ย ย ย ย ย ย border-radius: 20px;ย
ย ย ย ย ย ย text-align: center;ย
ย ย ย ย ย ย cursor: pointer;ย
ย ย ย ย ย ย border: 2px solid transparent;
ย ย ย ย ย ย box-shadow: var(--shadow);ย
ย ย ย ย ย ย flex-shrink: 0;
ย ย ย ย }
ย ย ย ย .cat-card.active {ย
ย ย ย ย ย ย border-color: var(--verde-oscuro);ย
ย ย ย ย ย ย background: var(--verde-oscuro);ย
ย ย ย ย ย ย color: white;ย
ย ย ย ย ย ย transform: translateY(-5px);
ย ย ย ย }
ย ย ย ย .cat-card i { font-size: 1.5rem; color: var(--dorado); margin-bottom: 8px; display: block; }
ย ย ย ย .cat-card span { font-weight: 600; font-size: 0.9rem; }

ย ย ย ย /* FILTROS Y BUSCADOR */
ย ย ย ย .filters-wrapper {ย
ย ย ย ย ย ย background: white;ย
ย ย ย ย ย ย padding: 25px;ย
ย ย ย ย ย ย border-radius: 25px;ย
ย ย ย ย ย ย margin-bottom: 40px;ย
ย ย ย ย ย ย box-shadow: var(--shadow);ย
ย ย ย ย }
ย ย ย ย .search-box {ย
ย ย ย ย ย ย width: 100%;ย
ย ย ย ย ย ย padding: 18px 25px;ย
ย ย ย ย ย ย border: 1px solid #eee;ย
ย ย ย ย ย ย border-radius: 50px;ย
ย ย ย ย ย ย outline: none;ย
ย ย ย ย ย ย font-family: 'Montserrat';
ย ย ย ย ย ย font-size: 1rem;
ย ย ย ย ย ย background: #fdfdfd;
ย ย ย ย }

ย ย ย ย /* GRID DE PRODUCTOS */
ย ย ย ย .grid {ย
ย ย ย ย ย ย display: grid;ย
ย ย ย ย ย ย grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));ย
ย ย ย ย ย ย gap: 30px;ย
ย ย ย ย }

ย ย ย ย .product-card {ย
ย ย ย ย ย ย background: white;ย
ย ย ย ย ย ย border-radius: 25px;ย
ย ย ย ย ย ย overflow: hidden;ย
ย ย ย ย ย ย position: relative;ย
ย ย ย ย ย ย border: 1px solid rgba(0,0,0,0.03);
ย ย ย ย ย ย display: flex;ย
ย ย ย ย ย ย flex-direction: column;
ย ย ย ย ย ย box-shadow: 0 5px 15px rgba(0,0,0,0.02);
ย ย ย ย }
ย ย ย ย .product-card:hover { transform: translateY(-10px); box-shadow: 0 15px 35px rgba(0,0,0,0.1); }

ย ย ย ย .img-container {ย
ย ย ย ย ย ย height: 300px;ย
ย ย ย ย ย ย display: flex;ย
ย ย ย ย ย ย align-items: center;ย
ย ย ย ย ย ย justify-content: center;ย
ย ย ย ย ย ย padding: 30px;ย
ย ย ย ย ย ย position: relative;ย
ย ย ย ย ย ย background: #fafafa;
ย ย ย ย }
ย ย ย ย .img-container img { max-width: 100%; max-height: 100%; object-fit: contain; }
ย ย ย ยย
ย ย ย ย .fav-btn {
ย ย ย ย ย ย position: absolute; top: 20px; right: 20px;ย
ย ย ย ย ย ย background: white; border: none; border-radius: 50%;ย
ย ย ย ย ย ย width: 45px; height: 45px; display: flex;ย
ย ย ย ย ย ย align-items: center; justify-content: center;
ย ย ย ย ย ย cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.1);ย
ย ย ย ย ย ย color: #ddd; z-index: 10;
ย ย ย ย }
ย ย ย ย .fav-btn.active { color: var(--rojo); }

ย ย ย ย .badge-promo {ย
ย ย ย ย ย ย position: absolute; top: 20px; left: 20px;ย
ย ย ย ย ย ย background: var(--dorado); color: white;ย
ย ย ย ย ย ย padding: 6px 15px; border-radius: 50px;ย
ย ย ย ย ย ย font-size: 0.75rem; font-weight: 700;ย
ย ย ย ย }

ย ย ย ย .info { padding: 25px; text-align: center; flex-grow: 1; }
ย ย ย ย .info h3 { margin: 15px 0; font-size: 1.2rem; min-height: 54px; font-weight: 600; color: var(--verde-oscuro); }
ย ย ย ยย
ย ย ย ย .price-container { margin: 15px 0; min-height: 60px; }
ย ย ย ย .price { font-size: 1.8rem; font-weight: 700; color: var(--verde-oscuro); margin: 0; }
ย ย ย ย .old-price { font-size: 1rem; color: #999; text-decoration: line-through; display: block; }

ย ย ย ย .btn-add {ย
ย ย ย ย ย ย width: 100%;ย
ย ย ย ย ย ย background: var(--verde-oscuro);ย
ย ย ย ย ย ย color: white;ย
ย ย ย ย ย ย border: none;ย
ย ย ย ย ย ย padding: 18px;ย
ย ย ย ย ย ย font-weight: 700;ย
ย ย ย ย ย ย cursor: pointer;ย
ย ย ย ย ย ย font-size: 0.9rem;
ย ย ย ย ย ย text-transform: uppercase;
ย ย ย ย ย ย letter-spacing: 1px;
ย ย ย ย }
ย ย ย ย .btn-add:hover { background: var(--dorado); }

ย ย ย ย /* CARRITO / RESUMEN */
ย ย ย ย .cart-summary {ย
ย ย ย ย ย ย position: fixed; bottom: 0; left: 50%;ย
ย ย ย ย ย ย transform: translateX(-50%) translateY(105%);ย
ย ย ย ย ย ย background: white; padding: 35px;ย
ย ย ย ย ย ย border-radius: 40px 40px 0 0;ย
ย ย ย ย ย ย box-shadow: 0 -15px 50px rgba(0,0,0,0.2);ย
ย ย ย ย ย ย z-index: 2000; width: 100%;ย
ย ย ย ย ย ย max-width: 600px; max-height: 90vh;ย
ย ย ย ย ย ย overflow-y: auto;
ย ย ย ย }
ย ย ย ย .cart-summary.active { transform: translateX(-50%) translateY(0); }

ย ย ย ย .cart-list { margin: 20px 0; padding: 0; list-style: none; }
ย ย ย ย .cart-item {ย
ย ย ย ย ย ย display: flex; justify-content: space-between;ย
ย ย ย ย ย ย padding: 12px 0; border-bottom: 1px solid #eee;ย
ย ย ย ย ย ย font-size: 0.95rem;ย
ย ย ย ย }

ย ย ย ย .payment-methods { margin: 25px 0; }
ย ย ย ย .methods-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 10px; }
ย ย ย ย .method-opt {ย
ย ย ย ย ย ย padding: 15px; border: 2.5px solid #eee; border-radius: 15px;ย
ย ย ย ย ย ย font-size: 0.85rem; cursor: pointer; text-align: center;ย
ย ย ย ย ย ย font-weight: 700; color: #666;
ย ย ย ย }
ย ย ย ย .method-opt.selected {ย
ย ย ย ย ย ย border-color: var(--azul-pago);ย
ย ย ย ย ย ย background: #f0f8ff;ย
ย ย ย ย ย ย color: var(--azul-pago);ย
ย ย ย ย }

ย ย ย ย .coupon-box { display: flex; gap: 10px; margin-bottom: 20px; }
ย ย ย ย .coupon-box input {ย
ย ย ย ย ย ย flex: 1; padding: 15px; border: 1px solid #ddd;ย
ย ย ย ย ย ย border-radius: 15px; font-family: 'Montserrat';ย
ย ย ย ย }
ย ย ย ย .btn-coupon {ย
ย ย ย ย ย ย background: var(--verde-oscuro); color: white;ย
ย ย ย ย ย ย border: none; padding: 0 25px; border-radius: 15px;ย
ย ย ย ย ย ย cursor: pointer; font-weight: 700;ย
ย ย ย ย }

ย ย ย ย .totals-card { background: #f9f9f9; padding: 25px; border-radius: 20px; margin-bottom: 25px; }
ย ย ย ย .total-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 1rem; }
ย ย ย ย .total-main { font-size: 1.8rem; font-weight: 700; color: var(--verde-oscuro); border-top: 2px solid #ddd; padding-top: 15px; margin-top: 10px; }

ย ย ย ย .whatsapp-float {ย
ย ย ย ย ย ย position: fixed; width: 65px; height: 65px;ย
ย ย ย ย ย ย bottom: 30px; right: 30px; background: #25d366;ย
ย ย ย ย ย ย color: white; border-radius: 50%; display: flex;ย
ย ย ย ย ย ย align-items: center; justify-content: center;ย
ย ย ย ย ย ย font-size: 35px; z-index: 1000; text-decoration: none;ย
ย ย ย ย ย ย box-shadow: 0 10px 25px rgba(37,211,102,0.3);ย
ย ย ย ย }

ย ย ย ย @media (max-width: 600px) {
ย ย ย ย ย ย header { padding: 40px 15px; }
ย ย ย ย ย ย .grid { grid-template-columns: 1fr; }
ย ย ย ย ย ย .cart-summary { padding: 25px 15px; border-radius: 25px 25px 0 0; }
ย ย ย ย }
ย ย </style>
</head>
<body>

<div class="promo-pack" id="promoBanner">Cargando beneficios...</div>

<header>
ย ย <h1>Librerรญa Matita</h1>
</header>

<nav>
ย ย<a href="index.html">Inicio</a>
ย <a href="catalogo.html">Catรกlogo</a>ย
ย <a href="contacto.html">Contacto</a>
ย ย<a href="favorito.html">Favoritos โค๏ธ</a>
</nav>

<div class="container">
ย ย <div class="category-container" id="catBar">
ย ย ย ย <div class="cat-card active" onclick="filterCat('all', this)"><i class="fas fa-th-large"></i><span>Todos</span></div>
ย ย ย ย <div class="cat-card" onclick="filterCat('lengua', this)"><i class="fas fa-book"></i><span>Lengua</span></div>
ย ย ย ย <div class="cat-card" onclick="filterCat('matematica', this)"><i class="fas fa-calculator"></i><span>Mate</span></div>
ย ย ย ย <div class="cat-card" onclick="filterCat('ciencias', this)"><i class="fas fa-microscope"></i><span>Ciencias</span></div>
ย ย ย ย <div class="cat-card" onclick="filterCat('otros', this)"><i class="fas fa-plus-circle"></i><span>Otros</span></div>
ย ย </div>

ย ย <div class="filters-wrapper">
ย ย ย ย <input type="text" id="search" class="search-box" placeholder="ยฟQuรฉ libro o material buscรกs hoy?" oninput="render()">
ย ย </div>

ย ย <div class="grid" id="productGrid">
ย ย ย ย </div>
</div>

<div id="cartBar" class="cart-summary">
ย ย <div style="display:flex; justify-content:space-between; align-items:center;">
ย ย ย ย <h3 style="margin:0; font-family:'Playfair Display'; font-size:1.8rem;">Tu Carrito</h3>
ย ย ย ย <i class="fas fa-times" onclick="toggleCart(false)" style="cursor:pointer; font-size:1.5rem;"></i>
ย ย </div>
ย ยย
ย ย <ul id="cartList" class="cart-list"></ul>
ย ยย
ย ย <div class="coupon-box">
ย ย ย ย <input type="text" id="couponInput" placeholder="Cรณdigo de cupรณn">
ย ย ย ย <button class="btn-coupon" onclick="applyCoupon()">Validar</button>
ย ย </div>

ย ย <div class="payment-methods">
ย ย ย ย <strong style="font-size:0.9rem; text-transform:uppercase; color:#888;">Elegรญ cรณmo pagar:</strong>
ย ย ย ย <div class="methods-grid">
ย ย ย ย ย ย <div class="method-opt" onclick="selectPayment('Efectivo', this)">Efectivo (-10%)</div>
ย ย ย ย ย ย <div class="method-opt" onclick="selectPayment('Transferencia', this)">Transferencia</div>
ย ย ย ย ย ย <div class="method-opt" onclick="selectPayment('Mercado Pago', this)">Mercado Pago</div>
ย ย ย ย ย ย <div class="method-opt" onclick="selectPayment('Tarjeta', this)">Tarjeta</div>
ย ย ย ย </div>
ย ย </div>

ย ย <div class="totals-card">
ย ย ย ย <div class="total-row"><span>Subtotal:</span> <span id="cartSubtotal">$0</span></div>
ย ย ย ย <div id="discountRow" style="display:none; color: var(--rojo); font-weight:700;" class="total-row">
ย ย ย ย ย ย <span id="discountLabel">Bonificaciรณn:</span> <span id="cartDiscount">-$0</span>
ย ย ย ย </div>
ย ย ย ย <div class="total-row total-main">
ย ย ย ย ย ย <span>TOTAL:</span>
ย ย ย ย ย ย <span id="cartTotal">$0</span>
ย ย ย ย </div>
ย ย </div>

ย ย <div style="display:flex; gap:15px;">
ย ย ย ย <button onclick="vaciarCarrito()" style="flex:1; padding:20px; border:none; border-radius:15px; cursor:pointer; font-weight:700; background:#eee;">Limpiar</button>
ย ย ย ย <button onclick="sendOrder()" style="flex:2; background:var(--verde-whatsapp); color:white; border:none; border-radius:15px; font-weight:700; cursor:pointer; font-size:1.1rem; display:flex; align-items:center; justify-content:center; gap:10px;">
ย ย ย ย ย ย <i class="fab fa-whatsapp"></i> Finalizar Pedido
ย ย ย ย </button>
ย ย </div>
</div>

<a href="https://wa.me/3516062227" class="whatsapp-float" target="_blank"><i class="fab fa-whatsapp"></i></a>

<script>
ย ย // --- CONFIGURACIรN DE DATOS ---
ย ย const SUPABASE_URL = "https://xlwkzoapfbpoxaccvoea.supabase.co";
ย ย const SUPABASE_KEY = "sb_publishable_knGPyLLlMsy-YCQIblQnbQ_nrC8rV6x";
ย ย const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

ย ย let products = [];
ย ย let favorites = JSON.parse(localStorage.getItem('favoritos_matita')) || [];
ย ย let cart = [];
ย ย let currentCat = 'all';
ย ย let appliedCoupon = null;
ย ย let paymentMethod = "";

ย ย const configMatita = {ย
ย ย ย ย montoMinimoRegalo: 50000,ย
ย ย ย ย valorRegalo: 5000,
ย ย ย ย descEfectivo: 0.10 // 10% de descuento en efectivo
ย ย };

ย ย // --- CARGA DE PRODUCTOS ---
ย ย async function loadProducts() {
ย ย ย ย const { data, error } = await _supabase.from('productos').select('*');
ย ย ย ย if (error) {
ย ย ย ย ย ย console.error("Error:", error);
ย ย ย ย } else {
ย ย ย ย ย ย products = data;
ย ย ย ย ย ย render();
ย ย ย ย }
ย ย }

ย ย // --- RENDERIZADO ---
ย ย function render() {
ย ย ย ย const grid = document.getElementById('productGrid');
ย ย ย ย const searchVal = document.getElementById('search').value.toLowerCase();
ย ย ย ย grid.innerHTML = '';
ย ย ย ยย
ย ย ย ย const filtered = products.filter(p => {
ย ย ย ย ย ย const matchesSearch = p.nombre.toLowerCase().includes(searchVal);
ย ย ย ย ย ย const matchesCat = (currentCat === 'all' || p.categoria === currentCat);
ย ย ย ย ย ย return matchesSearch && matchesCat;
ย ย ย ย });

ย ย ย ย filtered.forEach(p => {
ย ย ย ย ย ย const isFav = favorites.includes(p.nombre) ? 'active' : '';
ย ย ย ย ย ย const imgUrl = p.imagen.includes('cloudinary') ? p.imagen.replace('/upload/', '/upload/f_auto,q_auto/') : p.imagen;
ย ย ย ย ย ยย
ย ย ย ย ย ย grid.innerHTML += `
ย ย ย ย ย ย ย ย <div class="product-card">
ย ย ย ย ย ย ย ย ย ย <div class="img-container">
ย ย ย ย ย ย ย ย ย ย ย ย ${p.etiqueta && p.etiqueta !== 'ninguna' ? `<div class="badge-promo">${p.etiqueta}</div>` : ''}
ย ย ย ย ย ย ย ย ย ย ย ย <button class="fav-btn ${isFav}" onclick="toggleFav('${p.nombre}')"><i class="fas fa-heart"></i></button>
ย ย ย ย ย ย ย ย ย ย ย ย <img src="${imgUrl}" onerror="this.src='https://via.placeholder.com/300'">
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div class="info">
ย ย ย ย ย ย ย ย ย ย ย ย <small style="color:var(--dorado); font-weight:700; text-transform:uppercase">${p.categoria}</small>
ย ย ย ย ย ย ย ย ย ย ย ย <h3>${p.nombre}</h3>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="price-container">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ${p.precioAnterior ? `<span class="old-price">$${Number(p.precioAnterior).toLocaleString('es-AR')}</span>` : ''}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p class="price">$${Number(p.precio).toLocaleString('es-AR')}</p>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย <button class="btn-add" onclick="addToCart('${p.nombre}', ${p.precio})">Sumar al Carrito</button>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </div>`;
ย ย ย ย });
ย ย }

ย ย // --- LรGICA DEL CARRITO ---
ย ย function addToCart(name, price) {
ย ย ย ย cart.push({name, price});
ย ย ย ย updateCartUI();
ย ย ย ย toggleCart(true);
ย ย }

ย ย function toggleCart(show) {
ย ย ย ย document.getElementById('cartBar').classList.toggle('active', show);
ย ย }

ย ย function selectPayment(method, el) {
ย ย ย ย paymentMethod = method;
ย ย ย ย document.querySelectorAll('.method-opt').forEach(opt => opt.classList.remove('selected'));
ย ย ย ย el.classList.add('selected');
ย ย ย ย updateCartUI();
ย ย }

ย ย function updateCartUI() {
ย ย ย ย const list = document.getElementById('cartList');
ย ย ย ย list.innerHTML = cart.map((item, index) => `
ย ย ย ย ย ย <li class="cart-item">
ย ย ย ย ย ย ย ย <span>${item.name}</span>
ย ย ย ย ย ย ย ย <strong>$${item.price.toLocaleString('es-AR')} <i class="fas fa-trash-alt" onclick="removeItem(${index})" style="color:var(--rojo); margin-left:10px; cursor:pointer"></i></strong>
ย ย ย ย ย ย </li>
ย ย ย ย `).join('');

ย ย ย ย let subtotal = cart.reduce((acc, item) => acc + item.price, 0);
ย ย ย ย let descuentoEfectivo = (paymentMethod.includes('Efectivo')) ? subtotal * configMatita.descEfectivo : 0;
ย ย ย ย let regaloExtra = (subtotal >= configMatita.montoMinimoRegalo) ? configMatita.valorRegalo : 0;
ย ย ย ย let cupรณnDesc = appliedCoupon ? subtotal * (appliedCoupon.descuento / 100) : 0;
ย ย ย ยย
ย ย ย ย let totalDescuentos = descuentoEfectivo + regaloExtra + cupรณnDesc;
ย ย ย ย let totalFinal = subtotal - totalDescuentos;

ย ย ย ย document.getElementById('cartSubtotal').innerText = `$${subtotal.toLocaleString('es-AR')}`;
ย ย ย ยย
ย ย ย ย if(totalDescuentos > 0) {
ย ย ย ย ย ย document.getElementById('discountRow').style.display = 'flex';
ย ย ย ย ย ย document.getElementById('cartDiscount').innerText = `-$${totalDescuentos.toLocaleString('es-AR')}`;
ย ย ย ย } else {
ย ย ย ย ย ย document.getElementById('discountRow').style.display = 'none';
ย ย ย ย }

ย ย ย ย document.getElementById('cartTotal').innerText = `$${(totalFinal < 0 ? 0 : totalFinal).toLocaleString('es-AR')}`;
ย ย }

ย ย async function applyCoupon() {
ย ย ย ย const input = document.getElementById('couponInput').value.trim().toUpperCase();
ย ย ย ย const { data, error } = await _supabase.from('cupones').select('*').eq('codigo', input).single();
ย ย ย ย if(data && !error) {
ย ย ย ย ย ย appliedCoupon = data;
ย ย ย ย ย ย alert("ยกCupรณn aplicado con รฉxito!");
ย ย ย ย ย ย updateCartUI();
ย ย ย ย } else {
ย ย ย ย ย ย alert("El cupรณn no existe o expirรณ.");
ย ย ย ย }
ย ย }

ย ย function removeItem(idx) {
ย ย ย ย cart.splice(idx, 1);
ย ย ย ย if(cart.length === 0) toggleCart(false);
ย ย ย ย updateCartUI();
ย ย }

ย ย function vaciarCarrito() {
ย ย ย ย cart = [];
ย ย ย ย paymentMethod = "";
ย ย ย ย appliedCoupon = null;
ย ย ย ย document.querySelectorAll('.method-opt').forEach(opt => opt.classList.remove('selected'));
ย ย ย ย toggleCart(false);
ย ย ย ย updateCartUI();
ย ย }

ย ย // --- ENVรO DE PEDIDO ---
ย ย async function sendOrder() {
ย ย ย ย if(cart.length === 0) return alert("El carrito estรก vacรญo.");
ย ย ย ย if(!paymentMethod) return alert("Por favor, seleccionรก un mรฉtodo de pago.");

ย ย ย ย let subtotal = cart.reduce((acc, item) => acc + item.price, 0);
ย ย ย ย let totalFinal = document.getElementById('cartTotal').innerText;

ย ย ย ย let mensaje = `*NUEVO PEDIDO - LIBRERรA MATITA*%0A%0A`;
ย ย ย ย mensaje += cart.map(i => `โข ${i.name}`).join('%0A');
ย ย ย ย mensaje += `%0A%0A*Pago:* ${paymentMethod}`;
ย ย ย ย mensaje += `%0A*Total:* ${totalFinal}`;
ย ย ย ย mensaje += `%0A%0A_Enviado desde la web_`;

ย ย ย ย // Guardar pedido en base de datos (opcional)
ย ย ย ย await _supabase.from('pedidos').insert([{
ย ย ย ย ย ย detalle: cart.map(i => i.name).join(", "),
ย ย ย ย ย ย total: subtotal,
ย ย ย ย ย ย pago: paymentMethod
ย ย ย ย }]);

ย ย ย ย window.open(`https://wa.me/3516062227?text=${mensaje}`, '_blank');
ย ย }

ย ย // --- OTROS ---
ย ย function filterCat(cat, el) {
ย ย ย ย currentCat = cat;
ย ย ย ย document.querySelectorAll('.cat-card').forEach(c => c.classList.remove('active'));
ย ย ย ย el.classList.add('active');
ย ย ย ย render();
ย ย }

ย ย function toggleFav(name) {
ย ย ย ย favorites = favorites.includes(name) ? favorites.filter(f => f !== name) : [...favorites, name];
ย ย ย ย localStorage.setItem('favoritos_matita', JSON.stringify(favorites));
ย ย ย ย render();
ย ย }

ย ย window.onload = () => {
ย ย ย ย document.getElementById('promoBanner').innerText = `๐ ยกRegalo de $${configMatita.valorRegalo.toLocaleString()} en compras mayores a $${configMatita.montoMinimoRegalo.toLocaleString()}!`;
ย ย ย ย loadProducts();
ย ย };
</script>
</body>
</html>
